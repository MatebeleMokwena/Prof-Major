const yearEl=document.getElementById("year");if(yearEl){yearEl.textContent=String(new Date().getFullYear())}
const links=document.querySelectorAll(".nav-links a");links.forEach(l=>{const path=window.location.pathname.split("/").pop();const href=l.getAttribute("href");if(href===path||(!path&&href==="index.html"))l.classList.add("active")});
const cartKey="m11-cart-items";function getCartItems(){const v=localStorage.getItem(cartKey);return v?JSON.parse(v):[]}function setCartItems(items){localStorage.setItem(cartKey,JSON.stringify(items));updateCartCount()}function cartCount(items){return items.reduce((s,it)=>s+(it.qty||1),0)}function updateCartCount(){const n=cartCount(getCartItems());const a=document.getElementById("cart-count");const b=document.getElementById("cart-count-side");if(a)a.textContent=String(n);if(b)b.textContent=String(n)}updateCartCount();function addToCart(item){const items=getCartItems();const idx=items.findIndex(i=>i.id===item.id&&i.type===item.type);if(idx>=0){items[idx].qty=(items[idx].qty||1)+1}else{item.qty=item.qty||1;items.push(item)}setCartItems(items)}function removeFromCart(index){const items=getCartItems();items.splice(index,1);setCartItems(items);renderCart()}document.querySelectorAll("[data-add-cart]").forEach(btn=>{btn.addEventListener("click",()=>{const t=btn.getAttribute("data-title")||"Item";const p=parseFloat(btn.getAttribute("data-price")||"0");const id=btn.getAttribute("data-id")||t;const type=btn.getAttribute("data-type")||"product";addToCart({id,type,title:t,price:p})})});
const homeSearch=document.getElementById("home-search");const homeSearchBtn=document.getElementById("home-search-btn");if(homeSearch&&homeSearchBtn){homeSearchBtn.addEventListener("click",()=>{const q=homeSearch.value.trim();if(q)window.location.href="beats.html?q="+encodeURIComponent(q)})}
async function fetchJSON(url){try{const r=await fetch(url);if(!r.ok)throw new Error();return await r.json()}catch(e){return null}}
function renderBeats(list){const ul=document.getElementById("beat-list");if(!ul)return;ul.innerHTML="";list.forEach(b=>{const li=document.createElement("li");li.className="list-item";li.innerHTML=`<div class="thumb"></div><div class="title">${b.title} ${b.bpm} bpm</div><div class="meta">${b.length}</div><div class="meta">${b.bpm} BPM</div><div class="tag">#${b.genre}</div><button class="btn add-cart" data-add-cart data-type="beat" data-id="${b.id}" data-title="${b.title}" data-price="${b.price}">$${b.price.toFixed(2)}</button>`;ul.appendChild(li)});ul.querySelectorAll("[data-add-cart]").forEach(btn=>{btn.addEventListener("click",()=>{const t=btn.getAttribute("data-title");const p=parseFloat(btn.getAttribute("data-price"));const id=btn.getAttribute("data-id");addToCart({id,type:"beat",title:t,price:p})})})}
function computeFiltered(list){let out=[...list];const bpmSel=document.getElementById("filter-bpm");const moodSel=document.getElementById("filter-mood");const genreSel=document.getElementById("filter-genre");const sortSel=document.getElementById("sort-by");const qInput=document.getElementById("beat-search");const q=(qInput&&qInput.value||"").toLowerCase();if(q)out=out.filter(b=>b.title.toLowerCase().includes(q));if(bpmSel){const v=bpmSel.value;if(v==="<120")out=out.filter(b=>b.bpm<120);if(v==="120-140")out=out.filter(b=>b.bpm>=120&&b.bpm<=140);if(v===">140")out=out.filter(b=>b.bpm>140)}if(moodSel&&moodSel.value!="all")out=out.filter(b=>b.mood===moodSel.value);if(genreSel&&genreSel.value!="all")out=out.filter(b=>b.genre===genreSel.value);if(sortSel){if(sortSel.value==="bpm")out.sort((a,b)=>a.bpm-b.bpm);if(sortSel.value==="length")out.sort((a,b)=>a.length.localeCompare(b.length))}return out}
async function initBeats(){const beatListEl=document.getElementById("beat-list");if(!beatListEl)return;const params=new URLSearchParams(window.location.search);const q=params.get("q");const qInput=document.getElementById("beat-search");if(q&&qInput){qInput.value=q}const data=await fetchJSON("assets/data/beats.json");const base=data||[{id:"beat-1",title:"head banger",bpm:152,length:"3:23",genre:"trap",mood:"aggressive",price:25.95},{id:"beat-2",title:"grow",bpm:142,length:"3:36",genre:"trap",mood:"dark",price:25.95},{id:"beat-3",title:"bradley bill",bpm:133,length:"3:08",genre:"trap",mood:"chill",price:25.95},{id:"beat-4",title:"back in the boat",bpm:140,length:"3:40",genre:"trap",mood:"dark",price:25.95},{id:"beat-5",title:"war",bpm:181,length:"3:34",genre:"trap",mood:"aggressive",price:25.95}];renderBeats(base);const ids=["filter-bpm","filter-mood","filter-genre","sort-by","beat-search"];function apply(){renderBeats(computeFiltered(base))}ids.forEach(id=>{const el=document.getElementById(id);if(el){el.addEventListener("input",apply)}});const btn=document.getElementById("beat-search-btn");if(btn)btn.addEventListener("click",apply)}
async function initProducts(){const grid=document.getElementById("product-grid");if(!grid)return;const data=await fetchJSON("assets/data/products.json");const items=data||[{id:"prod-1",title:"Prof-Major Tâ€‘Shirt",price:25.99}];grid.innerHTML="";items.forEach(p=>{const card=document.createElement("div");card.className="card";card.innerHTML=`<div class="card-image placeholder"></div><div class="card-body"><h3>${p.title}</h3><p class="price">$${p.price.toFixed(2)}</p><div class="actions"><button class="btn" data-add-cart data-type="product" data-id="${p.id}" data-title="${p.title}" data-price="${p.price}">Add to Cart</button><a class="btn ghost" href="#">View Product Details</a></div></div>`;grid.appendChild(card)});grid.querySelectorAll("[data-add-cart]").forEach(btn=>{btn.addEventListener("click",()=>{const t=btn.getAttribute("data-title");const p=parseFloat(btn.getAttribute("data-price"));const id=btn.getAttribute("data-id");addToCart({id,type:"product",title:t,price:p})})})}
async function initKits(){const grid=document.getElementById("kit-grid");if(!grid)return;const data=await fetchJSON("assets/data/kits.json");const items=data||[{id:"kit-1",title:"MackSauce Kit",price:50}];grid.innerHTML="";items.forEach(k=>{const card=document.createElement("div");card.className="card";card.innerHTML=`<div class="card-image placeholder"></div><div class="card-body"><h3>${k.title}</h3><p class="price">$${k.price.toFixed(2)}</p><div class="actions"><button class="btn" data-add-cart data-type="kit" data-id="${k.id}" data-title="${k.title}" data-price="${k.price}">Add to Cart</button><a class="btn ghost" href="#">View Kit Details</a></div></div>`;grid.appendChild(card)});grid.querySelectorAll("[data-add-cart]").forEach(btn=>{btn.addEventListener("click",()=>{const t=btn.getAttribute("data-title");const p=parseFloat(btn.getAttribute("data-price"));const id=btn.getAttribute("data-id");addToCart({id,type:"kit",title:t,price:p})})})}
const form=document.getElementById("contact-form");if(form){form.addEventListener("submit",e=>{e.preventDefault();form.reset();alert("Message sent")})}
function renderCart(){const container=document.getElementById("cart-items");const empty=document.getElementById("cart-empty");if(!container||!empty)return;const items=getCartItems();if(items.length===0){empty.style.display="block";container.innerHTML=""}else{empty.style.display="none";container.innerHTML="";items.forEach((it,i)=>{const div=document.createElement("div");div.className="list-item";div.innerHTML=`<div class="thumb"></div><div class="title">${it.title}</div><div class="meta">$${Number(it.price).toFixed(2)}</div><div class="meta">Qty ${it.qty||1}</div><button class="btn" data-remove="${i}">Remove</button>`;container.appendChild(div)});container.querySelectorAll("[data-remove]").forEach(btn=>{btn.addEventListener("click",()=>{const idx=parseInt(btn.getAttribute("data-remove"));removeFromCart(idx)})})}}
initBeats();initProducts();initKits();renderCart();
